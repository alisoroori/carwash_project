<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Past Bookings API</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold mb-6">Test: Past Bookings API</h1>
        
        <button id="testBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Test API
        </button>
        
        <div id="result" class="mt-4"></div>
    </div>

    <script>
        document.getElementById('testBtn').addEventListener('click', async () => {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p class="text-gray-600">Loading...</p>';
            
            try {
                console.log('Fetching from: /carwash_project/backend/api/get_reservations.php');
                
                const response = await fetch('/carwash_project/backend/api/get_reservations.php', {
                    method: 'GET',
                    credentials: 'same-origin',
                    headers: { 
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest' 
                    }
                });
                
                console.log('Response status:', response.status, response.statusText);
                console.log('Response headers:', [...response.headers.entries()]);
                
                const text = await response.text();
                console.log('Raw response:', text);
                
                let data;
                try {
                    data = JSON.parse(text);
                    console.log('Parsed JSON:', data);
                } catch (e) {
                    throw new Error('Invalid JSON: ' + text.substring(0, 100));
                }
                
                let html = '<div class="bg-green-50 border border-green-200 rounded p-4 mb-4">';
                html += '<h3 class="font-bold text-green-800 mb-2">‚úÖ API Response</h3>';
                html += '<p><strong>Success:</strong> ' + data.success + '</p>';
                html += '<p><strong>Message:</strong> ' + data.message + '</p>';
                html += '<p><strong>Count:</strong> ' + (data.count || 0) + '</p>';
                html += '</div>';
                
                if (data.bookings && data.bookings.length > 0) {
                    html += '<div class="bg-blue-50 border border-blue-200 rounded p-4 mb-4">';
                    html += '<h3 class="font-bold text-blue-800 mb-2">üìã Bookings</h3>';
                    html += '<p><strong>Total:</strong> ' + data.bookings.length + '</p>';
                    html += '<h4 class="font-semibold mt-4 mb-2">First Booking:</h4>';
                    html += '<pre class="bg-white p-2 rounded text-xs overflow-auto">' + JSON.stringify(data.bookings[0], null, 2) + '</pre>';
                    html += '</div>';
                    
                    html += '<table class="min-w-full border">';
                    html += '<thead class="bg-gray-100"><tr>';
                    html += '<th class="border px-2 py-1">ID</th>';
                    html += '<th class="border px-2 py-1">Service</th>';
                    html += '<th class="border px-2 py-1">Date</th>';
                    html += '<th class="border px-2 py-1">Vehicle</th>';
                    html += '<th class="border px-2 py-1">Price</th>';
                    html += '</tr></thead><tbody>';
                    
                    data.bookings.forEach(b => {
                        html += '<tr>';
                        html += '<td class="border px-2 py-1">#' + b.booking_id + '</td>';
                        html += '<td class="border px-2 py-1">' + (b.service_name || 'N/A') + '</td>';
                        html += '<td class="border px-2 py-1">' + (b.booking_date || 'N/A') + '</td>';
                        html += '<td class="border px-2 py-1">' + (b.vehicle_plate || 'N/A') + '</td>';
                        html += '<td class="border px-2 py-1">‚Ç∫' + (b.total_price || '0') + '</td>';
                        html += '</tr>';
                    });
                    html += '</tbody></table>';
                } else {
                    html += '<div class="bg-yellow-50 border border-yellow-200 rounded p-4">';
                    html += '<p class="text-yellow-800">‚ö†Ô∏è No bookings returned</p>';
                    html += '</div>';
                }
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = '<div class="bg-red-50 border border-red-200 rounded p-4">';
                resultDiv.innerHTML += '<h3 class="font-bold text-red-800 mb-2">‚ùå Error</h3>';
                resultDiv.innerHTML += '<p class="text-red-700">' + error.message + '</p>';
                resultDiv.innerHTML += '</div>';
            }
        });
    </script>
</body>
</html>
