<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Form Test - CarWash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Profile Form Test</h1>
            
            <div id="testResults" class="mb-6 space-y-2"></div>
            
            <button onclick="runTests()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">
                <i class="fas fa-play mr-2"></i> Run Tests
            </button>
        </div>
    </div>

    <script>
        async function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="text-gray-600">Running tests...</div>';
            
            const tests = [];
            
            // Test 1: Check if database columns exist
            tests.push(await testDatabaseColumns());
            
            // Test 2: Check if profile form exists
            tests.push(await testProfileFormExists());
            
            // Test 3: Check if required fields are marked
            tests.push(await testRequiredFields());
            
            // Test 4: Check if file input accepts images
            tests.push(await testFileInput());
            
            // Display results
            displayResults(tests);
        }
        
        async function testDatabaseColumns() {
            try {
                const response = await fetch('/carwash_project/backend/dashboard/test_profile_columns.php');
                const data = await response.json();
                return {
                    name: 'Database Columns',
                    passed: data.success,
                    message: data.message
                };
            } catch (error) {
                return {
                    name: 'Database Columns',
                    passed: false,
                    message: 'Could not connect to database test endpoint'
                };
            }
        }
        
        async function testProfileFormExists() {
            try {
                const response = await fetch('/carwash_project/backend/dashboard/Customer_Dashboard.php');
                const html = await response.text();
                const hasForm = html.includes('id="profileForm"');
                const hasEnctype = html.includes('enctype="multipart/form-data"');
                
                return {
                    name: 'Profile Form Structure',
                    passed: hasForm && hasEnctype,
                    message: hasForm && hasEnctype ? 
                        'Form has correct ID and enctype' : 
                        'Form missing ID or enctype attribute'
                };
            } catch (error) {
                return {
                    name: 'Profile Form Structure',
                    passed: false,
                    message: error.message
                };
            }
        }
        
        async function testRequiredFields() {
            try {
                const response = await fetch('/carwash_project/backend/dashboard/Customer_Dashboard.php');
                const html = await response.text();
                
                const hasProfileImageInput = html.includes('id="profile_image"') && html.includes('required');
                const hasHomePhone = html.includes('id="profile_home_phone"') && html.includes('required');
                const hasNationalId = html.includes('id="profile_national_id"') && html.includes('required');
                const hasDriverLicense = html.includes('id="profile_driver_license"') && !html.match(/id="profile_driver_license"[^>]*required/);
                
                const allPassed = hasProfileImageInput && hasHomePhone && hasNationalId && hasDriverLicense;
                
                return {
                    name: 'Required Fields Validation',
                    passed: allPassed,
                    message: allPassed ? 
                        'All required fields marked correctly' : 
                        `Missing fields - Image: ${hasProfileImageInput}, Home Phone: ${hasHomePhone}, National ID: ${hasNationalId}, Driver License Optional: ${hasDriverLicense}`
                };
            } catch (error) {
                return {
                    name: 'Required Fields Validation',
                    passed: false,
                    message: error.message
                };
            }
        }
        
        async function testFileInput() {
            try {
                const response = await fetch('/carwash_project/backend/dashboard/Customer_Dashboard.php');
                const html = await response.text();
                
                const hasFileInput = html.includes('type="file"');
                const hasImageAccept = html.includes('accept="image/');
                const hasPreview = html.includes('id="profileImagePreview"');
                
                const allPassed = hasFileInput && hasImageAccept && hasPreview;
                
                return {
                    name: 'File Input Configuration',
                    passed: allPassed,
                    message: allPassed ? 
                        'File input configured correctly with image preview' : 
                        'File input missing or misconfigured'
                };
            } catch (error) {
                return {
                    name: 'File Input Configuration',
                    passed: false,
                    message: error.message
                };
            }
        }
        
        function displayResults(tests) {
            const results = document.getElementById('testResults');
            let html = '<div class="space-y-3">';
            
            let passedCount = 0;
            tests.forEach(test => {
                if (test.passed) passedCount++;
                
                html += `
                    <div class="flex items-start p-4 rounded-lg ${test.passed ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}">
                        <i class="fas ${test.passed ? 'fa-check-circle text-green-600' : 'fa-times-circle text-red-600'} text-xl mt-0.5 mr-3"></i>
                        <div>
                            <div class="font-semibold ${test.passed ? 'text-green-900' : 'text-red-900'}">${test.name}</div>
                            <div class="${test.passed ? 'text-green-700' : 'text-red-700'} text-sm mt-1">${test.message}</div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="font-bold text-blue-900 text-lg">
                        Test Summary: ${passedCount}/${tests.length} Passed
                    </div>
                </div>
            `;
            
            results.innerHTML = html;
        }
        
        // Auto-run tests on page load
        window.addEventListener('load', runTests);
    </script>
</body>
</html>